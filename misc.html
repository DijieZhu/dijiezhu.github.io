<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Misc — Dijie Zhu</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
  <style>
    .wrap{max-width:980px; margin:0 auto; padding:26px 20px 60px}
    .nav{display:flex; align-items:center; justify-content:flex-end; gap:22px; padding:10px 0 24px;}
    .nav a{color:#666; text-decoration:none}
    .nav a.active{color:#1a73e8; font-weight:600}
    h1{margin:0 0 8px}
    .muted{color:#666}
    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; align-items:start}
    figure{margin:0}
    figure img{width:100%; height:auto; display:block; border-radius:8px; cursor:zoom-in}
    figcaption{font-size:12px; color:#555; margin-top:6px}
    .section{margin-top:22px}
    .quote{white-space:pre-wrap; background:#fafafa; border:1px solid #eee; border-radius:8px; padding:10px 12px}
    @media (prefers-color-scheme: dark){
      .muted{color:#b7b7b7}
      .quote{background:#15161a; border-color:#2a2b2f}
    }

    /* Lightbox */
    .lightbox[hidden]{display:none}
    .lightbox{
      position:fixed; inset:0; z-index:9999;
      background:rgba(0,0,0,.88);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }
    .lightbox-inner{
      position:relative; max-width:96vw; max-height:90vh;
      display:flex; flex-direction:column; align-items:center; gap:10px;
    }
    .lightbox img{
      max-width:96vw; max-height:80vh; width:auto; height:auto; border-radius:8px;
      box-shadow:0 8px 30px rgba(0,0,0,.65);
    }
    .lightbox .cap{
      color:#fff; font-size:14px; text-align:center; opacity:.9
    }
    .lightbox button{
      position:absolute; background:rgba(0,0,0,.5); border:1px solid rgba(255,255,255,.25);
      color:#fff; cursor:pointer; border-radius:999px; padding:8px 12px; font-size:20px; line-height:1;
      transition:background .2s ease, transform .1s ease;
    }
    .lightbox button:hover{background:rgba(255,255,255,.12)}
    .lightbox .close{top:-8px; right:-8px}
    .lightbox .prev, .lightbox .next{
      top:50%; transform:translateY(-50%);
      font-size:26px; padding:10px 14px;
    }
    .lightbox .prev{left:-12px}
    .lightbox .next{right:-12px}
    @media (max-width: 600px){
      .lightbox .prev{left:6px}
      .lightbox .next{right:6px}
      .lightbox .close{top:6px; right:6px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="nav">
      <a href="./index.html">Bio</a>
      <a href="./misc.html" class="active">Misc</a>
    </nav>

    <header>
      <h1 class="name">Misc — Hobbies & Photos</h1>
      <p class="muted">Photos and notes are loaded from <code>./Misc/gallery.json</code> and <code>./Misc/notes.txt</code>.</p>
    </header>

    <section class="section" id="notes">
      <h2>notes</h2>
      <div id="notesBox" class="quote">Loading notes…</div>
    </section>

    <section class="section" id="photos">
      <h2>photos</h2>
      <p class="muted">Many friends say I have an eye for beauty. I hope these photos bring you a little joy and help you step away from any stress for a moment.</p>
      <div id="gallery" class="grid" aria-live="polite">Loading photos…</div>
    </section>

    <footer><p class="muted">Last updated: 2025-10-27</p></footer>
  </div>

  <!-- Lightbox markup -->
  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog" hidden>
    <div class="lightbox-inner" role="document">
      <img id="lightbox-img" alt="">
      <div id="lightbox-cap" class="cap"></div>
      <button id="lb-close" class="close" aria-label="Close">×</button>
      <button id="lb-prev" class="prev" aria-label="Previous">‹</button>
      <button id="lb-next" class="next" aria-label="Next">›</button>
    </div>
  </div>

  <script>
  (async function(){
    // Load notes
    try{
      const r = await fetch('./Misc/notes.txt', {cache:'no-cache'});
      if(!r.ok) throw 0;
      const txt = await r.text();
      document.getElementById('notesBox').textContent = txt.trim() || '（空）';
    }catch(e){
      document.getElementById('notesBox').textContent = 'Add your text to ./Misc/notes.txt';
    }

    // Load gallery
    let items = [];
    try{
      const r = await fetch('./Misc/gallery.json', {cache:'no-cache'});
      if(!r.ok) throw 0;
      items = await r.json();
    }catch(e){
      document.getElementById('gallery').innerHTML = '<p class="muted">Add a JSON file at <code>./Misc/gallery.json</code> with your images.</p>';
      return;
    }

    // Render photos
    const g = document.getElementById('gallery');
    g.innerHTML = '';
    items.forEach((it, idx) => {
      const fig = document.createElement('figure');
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.alt = it.alt || it.caption || 'Photo';
      img.src = it.thumb || it.src;        // allow optional thumbnail
      img.dataset.idx = idx;
      fig.appendChild(img);
      if(it.caption){
        const cap = document.createElement('figcaption');
        cap.textContent = it.caption;
        fig.appendChild(cap);
      }
      g.appendChild(fig);
    });

    // Lightbox behavior
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lightbox-img');
    const lbCap = document.getElementById('lightbox-cap');
    const btnPrev = document.getElementById('lb-prev');
    const btnNext = document.getElementById('lb-next');
    const btnClose = document.getElementById('lb-close');
    let cur = -1;

    function openAt(i){
      cur = (i + items.length) % items.length;
      const it = items[cur];
      lbImg.src = it.full || it.src;        // prefer 'full' if provided
      lbImg.alt = it.alt || it.caption || 'Photo';
      lbCap.textContent = it.caption || '';
      lb.removeAttribute('hidden');
      document.body.style.overflow = 'hidden';
    }
    function closeLB(){
      lb.setAttribute('hidden','');
      document.body.style.overflow = '';
      lbImg.src = '';
    }
    function next(n=1){ openAt(cur + n); }

    // click handler on gallery
    g.addEventListener('click', (e)=>{
      const t = e.target.closest('img');
      if(!t) return;
      openAt(parseInt(t.dataset.idx,10));
    });

    // controls
    btnClose.addEventListener('click', closeLB);
    btnPrev.addEventListener('click', ()=>next(-1));
    btnNext.addEventListener('click', ()=>next(1));
    lb.addEventListener('click', (e)=>{
      // click backdrop closes (ignore clicks on inner box)
      if(e.target === lb) closeLB();
    });

    // keyboard support
    document.addEventListener('keydown', (e)=>{
      if(lb.hasAttribute('hidden')) return;
      if(e.key === 'Escape') closeLB();
      else if(e.key === 'ArrowLeft') next(-1);
      else if(e.key === 'ArrowRight') next(1);
    });
  })();
  </script>
</body>
</html>
